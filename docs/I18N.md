# Internationalization (i18n) Guide

## Overview

Sokru now includes a comprehensive internationalization system that supports multiple languages with a standardized message format. The system is designed to be easily extensible for adding new languages.

## Supported Languages

- **English (en)** - Default language
- **Spanish (es)** - Full translation available

## Message Format Standards

All messages use standardized prefixes for consistency:

- `✓` - Success messages (green/positive actions)
- `✗` - Error messages (red/failures)
- `→` - Info messages (blue/informational)
- `⚠` - Warning messages (yellow/caution)

## Usage

### Setting the Language

You can set your preferred language using the config command:

```bash
# Set to English (default)
sok config language en

# Set to Spanish
sok config language es

# Check current language
sok config language
```

The language setting is persisted in your configuration file (`~/.config/sokru/config.yaml`).

### Example Output

**English:**

```output
→ Reading symlinks configuration from: /home/user/.dotfiles/symlinks.yml
✓ Symlink created: /home/user/.bashrc -> /home/user/.dotfiles/bash/bashrc
✗ Error creating symlink: permission denied
⚠ Warning: file already exists
```

**Spanish:**

```output
→ Leyendo configuración de enlaces simbólicos desde: /home/user/.dotfiles/symlinks.yml
✓ Enlace simbólico creado: /home/user/.bashrc -> /home/user/.dotfiles/bash/bashrc
✗ Error al crear enlace simbólico: permiso denegado
⚠ Advertencia: el archivo ya existe
```

## For Developers

### Adding a New Language

To add support for a new language:

1. **Create a new messages file** in `internal/i18n/`:

   ```go
   // messages_fr.go (for French)
   package i18n

   func getFrenchMessages() map[MessageKey]string {
       return map[MessageKey]string{
           MsgErrorLoadingConfig: "Erreur lors du chargement de la configuration: %v",
           // ... add all message keys
       }
   }
   ```

2. **Add the language constant** in `internal/i18n/i18n.go`:

   ```go
   const (
       English Language = "en"
       Spanish Language = "es"
       French  Language = "fr"  // Add new language
   )
   ```

3. **Register the messages** in the `loadMessages()` function:

   ```go
   func (i *I18n) loadMessages() {
       i.messages[English] = getEnglishMessages()
       i.messages[Spanish] = getSpanishMessages()
       i.messages[French] = getFrenchMessages()  // Add new language
   }
   ```

4. **Update the language validation** in `cmd/config.go`:

   ```go
   if lang != "en" && lang != "es" && lang != "fr" {
       fmt.Fprintf(os.Stderr, "Error: Invalid language '%s'. Valid options are: en, es, fr\n", args[0])
       os.Exit(1)
   }
   ```

### Using i18n in Code

Import the i18n package:

```go
import "github.com/alexlm78/sokru/internal/i18n"
```

#### Basic Translation

```go
// Simple message
fmt.Println(i18n.T(i18n.MsgSymlinksStatus))

// Message with parameters
fmt.Printf("%s\n", i18n.T(i18n.MsgFoundConfigurations, count))
```

#### Formatted Messages

```go
// Success message with ✓ prefix
fmt.Println(i18n.Success(i18n.MsgSymlinkCreated, target, source))

// Error message with ✗ prefix
log.Printf("%s", i18n.Error(i18n.MsgErrorLoadingConfig, err))

// Info message with → prefix
fmt.Println(i18n.Info(i18n.MsgReadingSymlinksFrom, filepath))

// Warning message with ⚠ prefix
fmt.Println(i18n.Warning(i18n.MsgSymlinkWrongTarget, target, existing, expected))
```

### Message Key Naming Convention

Message keys follow a consistent naming pattern:

- `Msg` prefix for all keys
- Descriptive name in PascalCase
- Group related messages together

Examples:

```go
const (
    MsgErrorLoadingConfig     MessageKey = "error_loading_config"
    MsgSymlinkCreated         MessageKey = "symlink_created"
    MsgReadingSymlinksFrom    MessageKey = "reading_symlinks_from"
)
```

### Adding New Messages

1. **Define the message key** in `internal/i18n/messages_en.go`:

   ```go
   const (
       // ... existing keys
       MsgNewFeature MessageKey = "new_feature"
   )
   ```

2. **Add translations** in all language files:

   ```go
   // messages_en.go
   MsgNewFeature: "New feature message: %s",

   // messages_es.go
   MsgNewFeature: "Mensaje de nueva característica: %s",
   ```

3. **Use in code**:

   ```go
   fmt.Println(i18n.Success(i18n.MsgNewFeature, featureName))
   ```

## Architecture

### Package Structure

```diagram
internal/i18n/
├── i18n.go          # Core i18n functionality
├── messages_en.go   # English translations
└── messages_es.go   # Spanish translations
```

### Key Components

- **`I18n` struct**: Manages the current language and message translations
- **`MessageKey` type**: Type-safe message identifiers
- **`Language` type**: Supported language codes
- **Helper functions**: `T()`, `Success()`, `Error()`, `Info()`, `Warning()`

### Thread Safety

The i18n system uses a singleton pattern with mutex locks to ensure thread-safe access to translations.

## Configuration

The language setting is stored in `~/.config/sokru/config.yaml`:

```yaml
dotfiles_dir: /home/user/dotfiles
symlinks_file: /home/user/dotfiles/symlinks.yaml
os: linux
language: en  # or "es" for Spanish
verbose: false
dry_run: false
```

## Best Practices

1. **Always use message keys** instead of hardcoded strings
2. **Use appropriate message types** (Success, Error, Info, Warning)
3. **Provide context** in error messages with parameters
4. **Keep translations consistent** across all languages
5. **Test with multiple languages** before committing changes

## Future Enhancements

Potential improvements for the i18n system:

- [ ] Support for locale-specific formatting (dates, numbers)
- [ ] Pluralization support
- [ ] Language auto-detection from system locale
- [ ] External translation files (JSON/YAML)
- [ ] Translation validation tools
- [ ] Community translation contributions

## Contributing Translations

We welcome contributions for new language translations! Please:

1. Follow the existing message key structure
2. Maintain consistent formatting and tone
3. Test thoroughly with the language
4. Update this documentation
5. Submit a pull request

For questions or issues related to i18n, please open an issue on GitHub.
